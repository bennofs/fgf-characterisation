\documentclass[aspectratio=169]{beamer}

\usetheme{auriga}
\input{settings/packages.tex}
\usepackage{appendixnumberbeamer}

%\includeonlyframes{current}

\lstset{upquote=true}
%\setsansfont[BoldFont={Fira Sans SemiBold}]{Fira Sans Book}
\makeatletter
\newlength\beamerleftmargin
\setlength\beamerleftmargin{\Gm@lmargin}
\makeatother

\hypersetup{bookmarks=true,colorlinks=true,allcolors=blue}

\title{\textcolor{tolhighcontrastBlue}{A Constructive Proof of a Van~Benthem Theorem for the Forward Guarded Fragment of First~Order~Logic}}
\author{Benno Fünfstück}
\institute{\textcolor{toldarkDarkcyan}{Master's defense}}
\date{24.06.2024}

\include{tolcolors.tex}
\input{macros.tex}
\input{beamermacros.tex}

\begin{document}

\begin{frame}
  \titlepage
\end{frame}

\begin{frame}{What is the ``Forward Guarded Fragment ($\FGF$)''?}
  \textbf{guarded}: quantification follows pattern ``$\exists{\elemtuplex} (\relR(\vartuplex, \vartupley) \land \varphi(\vartuplex, \vartupley))$''
  \vspace{0.5em}
  \begin{overprint}
    \onslide<-2>
      \begin{exampleblock}{Example 1}
        $\varphi_{1} = \exists{x_{1}x_{2}}\; (\relE(x_{1}, x_{2}) \land (\exists{x_{3}}(\relE(x_{2}, x_{3}) \land \relP(x_{3}))$
        \begin{center}
        \input{res/ex1.tex}
        \end{center}
      \end{exampleblock}
      \uncover<2>{
      \begin{alertblock}{Counterexample 1}
        $\varphi_{2} = \exists{x_{1}x_{2}}\; (\relE(x_{1}, x_{2}) \land (\exists{x_{3}}(\relE(x_{2}, x_{3}) \land \relE(x_{3}, x_{1}))$
        \begin{center}
        \input{res/counterex1.tex}
        \end{center}
      \end{alertblock}
      }
    \onslide<3->
      \begin{exampleblock}{More examples}
        \vspace{1em}
        \hspace{1em}
        \begin{minipage}{20em}
        $\varphi_{3} = \lnot \exists{x_{1}x_{2}}\; (\relG(x_{1}, x_{2}) \land \lnot \relE(x_{2}, x_{1}))$ \\[1em]
        $\varphi_{3} = \forall{x_{1}x_{2}}\; (\relG(x_{1}, x_{2}) \to \relE(x_{2}, x_{1}))$ \\[1em]
        $\varphi_{4} = \forall{x_{1}}\; (\relG(x_{1}, x_{1}) \to \exists{x_{2}} (\relP(x_{1},x_{2}, x_{1})))$
        \end{minipage}
      \end{exampleblock}
  \end{overprint}
\end{frame}

\begin{frame}{What is the ``Forward Guarded Fragment ($\FGF$)''?}
  \textbf{forward}: variables must appear in order $x_{1}$, $x_2$, \ldots
  \vspace{0.5em}
  \begin{alertblock}{Counterexamples}
    $\varphi_{3} = \forall{x_{1}x_{2}}\; (\relG(x_{1}, x_{2}) \to \relE(x_{2}, x_{1}))$ \\[1em]
    $\varphi_{5} = \exists{x_{1}}\; (\relE(x_{1}, x_{1}))$ \\[1em]
    $\varphi_{6} = \exists{x_{1}x_{2}x_{3}}\; (\relP(x_{1}, x_{2}, x_{3}) \land \relE(x_{1}, x_{3}))$ \\[1em]
    $\varphi_{7} = \exists{x_{2}x_{1}} \relE(x_{2}, x_{1})$
  \end{alertblock}

  \begin{exampleblock}{Examples}
    $\varphi_{1} = \exists{x_{1}x_{2}}\; (\relE(x_{1}, x_{2}) \land (\exists{x_{3}}(\relE(x_{2}, x_{3}) \land \relP(x_{3}))$ \\[1em]

    $\varphi_{8} = \exists{x_{1}x_{2}x_{3}}\; (\relP(x_{1}x_{2}x_{3}) \land \exists{x_{3}}(\relE(x_{2}, x_{3})))$ \\[1em]
    $\varphi_{9} = \exists{x_{1}x_{2}x_{3}}\; (\relP(x_{1}x_{2}x_{3}) \land \relE(x_{2}, x_{3}))$ \\[1em]
  \end{exampleblock}

  \vskip 0pt plus 1filll
\end{frame}

\begin{frame}{How expressive is $\FGF$?}
  \begin{center}
    \input{res/bisim1.tex}
  \end{center}
  \begin{itemize}
    \item \emph{FGF-bisimulation}: equivalence relation on structures
    \item $\FGF$-formulae are $\FGF$-bisimulation-invariant
    \item \textbf{Can we express all $\FGF$-bisimulation-invariant $\FO$-definable properties in $\FGF$?}
  \end{itemize}
\end{frame}

\begin{frame}\frametitle<1>{Van Benthem's theorem}\frametitle<2>{Van Benthem's theorem (finitary version)}
  \begin{theorem}[Van Benthem's theorem for $\FGF$]
    A first-order formula $\varphi$ is equivalent to some $\FGF$-formula\only<2>{ \textbf{over finite structures}} if and only if it is invariant under $\FGF$-bisimulation\only<2>{ \textbf{over finite structures}}.
  \end{theorem}
\end{frame}

\begin{frame}<-2>[label=outline]{Outline}%
  \begin{enumerate}
    \item<alert@2| check@3-> Definitions: $\GF$-, $\FGF$- and $\ell$-bisimulation
    \item<check@3-> Observation: $\ell$-$\FGF$-invariance implies expressibility in $\FGF$
    \item<alert@4>
          Upgrading: $\FGF$-invariance implies $\ell$-$\FGF$-invariance
          \only<3->{\uncover<4->{\\\textcolor{black}{\small(Martin Otto has proved the same for $\GF$)}}}
  \end{enumerate}

  \onslide*<3->{
  \uncover<4->{
    \begin{itemize}
      \item[]
            \begin{center}
              \input{res/upgrade-plan.tex}
            \end{center}
    \end{itemize}
  }
  }
\end{frame}

\begin{frame}{$\GF$-bisimulation: partial isomorphism}
  A $\GF$-bisimulation is a set $\mathcal{Z}$ of \emph{partial isomorphisms} between two structures, satisfying \emph{back-and-forth conditions} (next slide)
  \vfill
  \begin{center}
  \input{res/partiso.tex}
  \end{center}
\end{frame}

\begin{frame}
  \frametitle{$\GF$-bisimulation: back-and-forth}
  \begin{center}
    \input{res/gfbackandforth.tex}
    \gfbackandforth{ante}
    \pause\vfill
    \gfbackandforth{conseq}
    \begin{tikzpicture}[remember picture,overlay]
      \node[yshift=-2.5em, xshift=-1em, rotate=-90, font=\LARGE\bfseries] (implies) at (current page.center) { $\implies$ };
      \node[right=0.5em of implies.center] { (forth) };
    \end{tikzpicture}
  \end{center}
\end{frame}

\begin{frame}{$\GF$-bisimulation: example}
\end{frame}

\begin{frame}{$\FGF$-bisimulation: forward partial map}
  An $\FGF$-bisimulation is a set $\mathcal{Z}$ of \emph{forward partial maps} between two structures, satisfying \emph{back-and-forth conditions} (next slide)
  \begin{center}
    \input{res/forwardmap.tex}
    \forwardmap{
      nonforwardedges/.style = {
        onslide=<3>{opacity=0.2},
      },
      tuples/.style = {
        onslide=<1>{hidden, every path/.style=hidden},
      },
      caption/.style={
        onslide=<-2>{hidden},
      }
    }
  \end{center}
\end{frame}

\begin{frame}{$\FGF$-bisimulation: back and forth}
  \input{res/fgfbackandforth}
  \begin{center}
    \fgfbackandforth{
      conseq/.style={hidden, overlay},
      tupler/.style={uncover=<3->},
      infix/.style={uncover=<2>}
    }
  \uncover<4->{
  \vfill
  \fgfbackandforth{ante/.style={hidden, overlay}}
  \begin{tikzpicture}[remember picture,overlay]
    \node[xshift=-1em, rotate=-90, font=\LARGE\bfseries] (implies) at (current page.center) { $\implies$ };
    \node[right=0.5em of implies.center] { (forth) };
  \end{tikzpicture}
  }
  \end{center}
\end{frame}

\begin{frame}{$\FGF$-bisimulation: example}
  \begin{center}
    \input{res/fgf-bisim-simple}
  \end{center}
\end{frame}

\begin{frame}{$\ell$-bisimulation}
  The sets $\mathcal{Z}_{0} \supseteq \cdots \supseteq \mathcal{Z}_{\ell}$ form an \textbf{$\ell$-bisimulation} ($\bisimto^{\ell}$) if $\mathcal{Z}_{i}$ contains the witnesses for the back-and-forth conditions of $\mathcal{Z}_{i+1}$.

  \vspace{0.5em}

  \begin{center}
    \tikz {
      \node (p) { $\homop \in \mathcal{Z}_{i}$ };
      \node[right=5em of p] (f) { $\homof \in \mathcal{Z}_{i-1}$ };
      \draw[->,thick] ($(p.east) + (0.5em,0em)$) -- node[above,midway] {(forth)} ($(f.west) - (0.5em,0em)$);
    }
  \end{center}

  \vspace{1em}

  \pause
  The \textbf{quantifier rank $\qr(\varphi)$} is the maximum degree of nesting of quantifiers in $\varphi$. \\[1em]
  $\FGF_{\ell}$ denotes the set of all $\FGF$ formulae with quantifier rank at most $\ell$.\\[0.5em]
  \begin{example}
    $\varphi(x) = \forall{y}\; \textcolor{tolbrightRed}{\textbf{(}}\relR(x,y) \to \exists{z} \relR(y,z)\textcolor{tolbrightRed}{\textbf{)}} \lor \exists{y}\textcolor{tolbrightRed}{\textbf{(}}\relR(x,y) \land \relP(y)\textcolor{tolbrightRed}{\textbf{)}}$ has quantifier rank 2, hence $\varphi \in \FGF_{2}$.
  \end{example}
\end{frame}

\begin{frame}{$\FGF_{\ell}$-invariance $\cong$ $\FGF$-expressible}
  \textbf{every $\FGF_{\textcolor{tolhighcontrastRed}{\ell}}$-invariant $\varphi$ is expressible in $\FGF$}:
  \begin{enumerate}
    \item each $\bisimto_{\FGF}^{\ell}$ equivalence class is characterized by some $\FGF_{\ell}$ formula
    \item the number of distinct $\FGF_{\ell}$ formulae is finite
    \item let $\mathcal{C}$ be the set of charateristic formulae of those $\bisimto_{\FGF}^{\ell}$ equivalence classes in which $\varphi$ is satisfied
    \item now, $\varphi \equiv \bigvee C$
  \end{enumerate}
  \vspace{0.5em}
  \begin{center}
  \input{res/finite-classes}
  \end{center}
\end{frame}

\againframe<3->{outline}

\begin{frame}{Tree unraveling}
  \begin{center}
    \input{res/tree-simple}
  \end{center}
\end{frame}


\begin{frame}{Higher-arity relations: HAF unraveling}
  \input{res/ex-other-unravel-hat}
  \input{res/ex-other-unravel-struct}

  \begin{columns}
    \begin{column}{0.2\textwidth}
      \begin{overprint}
        \onslide<1>

        \onslide<2-3>
        \exunravelstruct{reledges/.style={hidden}, gaifman/.style={}}

        \onslide<4>
        \exunravelstruct{gaifman/.style={}}
      \end{overprint}
    \end{column}
    \begin{column}{0.75\textwidth}
      \begin{overprint}
        \onslide<1-2>
        \exunravelstruct{}

        \onslide<3>
        \exunravelhat{reledges/.style={hidden}}

        \onslide<4>
        \exunravelhat{}
      \end{overprint}
    \end{column}
  \end{columns}
\end{frame}

\begin{frame}{HAF-unraveling does not upgrade to $\GF$}
  \input{res/hat-not-gf-unravel}
\end{frame}

\begin{frame}{Biseqs and Bipoints}
  \input{res/biseq}
\end{frame}

\begin{frame}{The forward unraveling $\unravel{A}$}
  \input{res/bipoint-tree}
\end{frame}

\begin{frame}{Cutting to obtain a finite unraveling}
  \begin{center}
    \input{res/cutting}
  \end{center}
\end{frame}

\begin{frame}{The finite forward unraveling $\unravel{A}_{\ell}$}
  \input{res/finite-unraveling}
\end{frame}

\begin{frame}{Finite forward unraveling upgrades from $\FGF$ to $\GF$}
  \textbf{Claim:} If $\str{A} \bisimto_{\FGF}^{\homof_{1}(g)} \str{B}$, then $\unravel{A}_{\homof_{2}(g)} \bisimto_{\GF}^{g} \unravel{B}_{\homof_{2}(g)}$ (for some functions $\homof_{1}$ and $\homof_{2}$)\\[1.5em]

  \textbf{Properties of the unraveling:}\\[0.5em]
  \begin{enumerate}
    \item If $(\elemtuples, \elemtuplet)$ is a forward partial map, then $\homop: s_{i} \mapsto t_{i}$ is a partial isomorphism
          \vspace{0.5em}

          \input{res/forward-map-to-partiso}
    \item<2> The intersection of a guarded set $\mathcal{S}$ and a tuple $\elemtupler$ is an infix
          \vspace{0.5em}

          \input{res/guarded-sets-infix}
  \end{enumerate}
\end{frame}

\def\tups{\textcolor{tolmutedTeal}{\elemtuples}}
\def\tupt{\textcolor{tolmutedTeal}{\elemtuplet}}
\def\ij#1{\textcolor{tolmutedWine}{(i_{#1},j_{#1})}}
\def\op#1{\textcolor{tolmutedWine}{(o_{#1},p_{#1})}}
\def\picelemOneA{%
  \tikz[baseline] {
    \tikzset{el/.style={draw, circle, minimum height=2.3ex, font=\small, inner sep=0.2ex, fill=white}};
    \node[el,anchor=base] {1};
  }%
}
\def\picelemOneB{%
  \tikz[baseline] {%
    \tikzset{el/.style={draw, circle, minimum height=2.3ex, font=\small, inner sep=0.2ex, fill=white}};
    \node[el,anchor=base] {a};
  }%
}
\def\picelemTwoA{%
  \tikz[baseline] {
    \tikzset{el/.style={draw, circle, minimum height=2.3ex, font=\small, inner sep=0.2ex, fill=white}};
    \node[el,anchor=base] {2};
  }%
}
\def\picelemTwoB{%
  \tikz[baseline] {
    \tikzset{el/.style={draw, circle, minimum height=2.3ex, font=\small, inner sep=0.2ex, fill=white}};
    \node[el,anchor=base] {b};
  }%
}
\def\ni{\textcolor{tolbrightYellowDarker}{i}}
\def\nj{\textcolor{tolbrightYellowDarker}{j}}
\begin{frame}{$z$-similarity}
  \input{res/z-sim}
  \vspace{-1ex}
  \pause
  \begin{minipage}[t]{0.6\textwidth}
    \begin{definition}[$z$-similar elements]
      \vspace{2.5ex}
      \picelemOneA{} $= \langle \cdots\; \tups_{0} \ij{1} \tups_{1} \ij{2} \cdots \ij{z} \tups_{z} / x \rangle$

      \pause
      \vspace{2ex}
      \picelemOneB{} $= \langle \cdots\; \tupt_{0} \op{1} \tupt_{1} \op{2} \cdots \op{z} \tupt_{z} / y \rangle$
    \end{definition}
  \end{minipage}
  \begin{minipage}[t]{0.39\textwidth}
    \vspace{1.5ex}

    {\Large \picelemOneA{} $\approx_{z}$ \picelemOneB{} if:}
    \vspace{0.5ex}
    {\large\begin{enumerate}
      \item $x = y$,
      \item $\ij{k} = \op{k}$, and
      \item $(\str{A}, \tups_{k}) \bisimto_{\FGF}^{z} (\str{B}, \tupt_{k})$
    \end{enumerate}}
    \vspace{0.5ex}
    \hspace{3pt}for all $k \in [1,z]$.
  \end{minipage}
\end{frame}

\begin{frame}{$z$-similarity: forward extension}
  \begin{center}
  given $\;\picelemOneA{} \approx_{z} \picelemOneB{}\;$ with
  \begin{math}
    \begin{array}{l @{{}={}\langle{}} c @{{}/{}} c @{{}\rangle}}
      \picelemOneA{} & \cdots \tups_{z-1} \ij{z} \tups_{z} & x \\[1ex]
      \picelemOneB{} & \cdots \tupt_{z-1} \op{z} \tupt_{z} & y
    \end{array}
  \end{math}

  \vspace{3em}
  \begin{minipage}{0.8\textwidth}
  \begin{minipage}{4em}
    \textbf{Case 1}\\{}
  \end{minipage}
  \begin{math}
    \begin{array}{rl @{{}={}\langle{}} c @{{}/{}} c @{{}\rangle}}
      \text{if} & \picelemTwoA{} & \cdots \tups_{z-1}\ij{z} \tups_{z} & x + 1 \\[1ex]
      \text{then} & \picelemTwoB{} & \cdots \tupt_{z-1}\op{z} \tupt_{z} & y + 1
    \end{array}
  \end{math}

  \vspace{2em}
  \begin{minipage}{4em}
    \textbf{Case 2}\\{}
  \end{minipage}
  \begin{math}
    \begin{array}{rl @{{}={}\langle{}} c @{{}/{}} c @{{}\rangle}}
      \text{if} & \picelemTwoA{} & \cdots \tups_{z} (\ni,\nj) \tups_{z+1} & (\nj{-}\ni{+}1) + 1 \\[1ex]
      \text{then} & \picelemTwoB{} & \cdots \tupt_{z} (\ni,\nj) \tupt_{z+1} & (\nj{-}\ni{+}1) + 1
    \end{array}
  \end{math}
  \end{minipage}
  \end{center}
\end{frame}

\begin{frame}{$z$-similarity: backward extension}
  \begin{center}
  given $\;\picelemTwoA{} \approx_{z} \picelemTwoB{}\;$ with
  \begin{math}
    \begin{array}{l @{{}={}\langle{}} c @{{}/{}} c @{{}\rangle}}
      \picelemTwoA{} & \cdots \tups_{z-1} \ij{z} \tups_{z} & x \\[1ex]
      \picelemTwoB{} & \cdots \tupt_{z-1} \op{z} \tupt_{z} & y
    \end{array}
  \end{math}

  \vspace{3em}
  \begin{minipage}{0.8\textwidth}
  \begin{minipage}{4em}
    \textbf{Case 1}\\{}
  \end{minipage}
  \begin{math}
    \begin{array}{rl @{{}={}\langle{}} c @{{}/{}} c @{{}\rangle}}
      \text{if} & \picelemOneA{} & \cdots \tups_{z-1}\ij{z} \tups_{z} & x - 1 \\[1ex]
      \text{then} & \picelemOneB{} & \cdots \tupt_{z-1}\op{z} \tupt_{z} & y - 1
    \end{array}
  \end{math}

  \vspace{2em}
  \begin{minipage}{4em}
    \textbf{Case 2}\\{}
  \end{minipage}
  \begin{math}
    \begin{array}{rl @{{}={}\langle{}} c @{{}/{}} c @{{}\rangle}}
      \text{if} & \picelemOneA{} & \cdots \tups_{z-1} & j_{z} \\[1ex]
      \text{then} & \picelemOneB{} & \cdots \tupt_{z-1} & p_{z}
    \end{array}
  \end{math}
  \end{minipage}
  \end{center}
\end{frame}

\begin{frame}{Summary}
  \begin{center}
    \huge $\FGF \equiv \FO/{\bisimto_{\FGF}}$ \\[0.5ex]
    \large over finite structures
  \end{center}

  \begin{center}
  \begin{minipage}[t]{0.4\textwidth}
    \raggedleft

    {\usebeamercolor[fg]{item} proof via new unraveling} \\
    \input{res/upgrade-summary.tex}
  \end{minipage}
  \hspace{4em}
  \begin{minipage}[t]{0.4\textwidth}
    \raggedright

    {\usebeamercolor[fg]{item} bonus corollary} \\[1ex]

    \raggedleft
    \begin{minipage}{0.9\textwidth}
      \raggedright
      Decidability of checking whether a given $\GF$-formula is expressible in $\FGF$.
    \end{minipage}
  \end{minipage}
\end{center}
\end{frame}


\end{document}
